<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Breathing Timer&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Tailwind CSS CDN --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: "Inter", sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f0f4f8;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-height: 100vh;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 20px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #ffffff;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 30px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 15px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 500px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>select {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>-moz-appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234B5563'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-repeat: no-repeat;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-position: right 0.75rem center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-size: 1.5em;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-right: 2.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>canvas {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #e2e8f0; /* Light blue-gray for the animation background */</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%; /* Make canvas responsive */</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 440px; /* Limit max width to fit container */</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 150px; /* Fixed height for animation area */</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: block; /* Remove extra space below canvas */</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="bg-gray-100 flex items-center justify-center min-h-screen p-4"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="container space-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h1 class="text-4xl font-extrabold text-indigo-700 mb-8"&gt;Breathing Timer&lt;/h1&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Timer Display --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bg-indigo-100 text-indigo-800 text-6xl font-mono p-6 rounded-lg shadow-inner mb-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;span id="sessionTimerDisplay"&gt;00:00&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Animation Canvas --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;canvas id="breathingAnimationCanvas"&gt;&lt;/canvas&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Breathing Cycle Inputs --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="grid grid-cols-2 gap-6 md:grid-cols-4 mb-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-col items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="inhale" class="text-gray-700 text-lg font-semibold mb-2"&gt;Inhale (seconds)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;select id="inhale" class="form-select block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-lg"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-col items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="hold1" class="text-gray-700 text-lg font-semibold mb-2"&gt;Hold (seconds)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;select id="hold1" class="form-select block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-lg"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-col items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="exhale" class="text-gray-700 text-lg font-semibold mb-2"&gt;Exhale (seconds)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;select id="exhale" class="form-select block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-lg"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-col items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="hold2" class="text-gray-700 text-lg font-semibold mb-2"&gt;Hold (seconds)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;select id="hold2" class="form-select block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-lg"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Session Timer Input --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="mb-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label for="sessionMinutes" class="text-gray-700 text-lg font-semibold mb-2 block"&gt;Session Duration (minutes)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;select id="sessionMinutes" class="form-select block mx-auto py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-lg w-32"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Controls --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="flex justify-center space-x-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="togglePlayPauseBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>Start</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="resetBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>Reset</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Get references to HTML elements</p>
<p class="p1"><span class="Apple-converted-space">        </span>const inhaleSelect = document.getElementById('inhale');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const hold1Select = document.getElementById('hold1');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const exhaleSelect = document.getElementById('exhale');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const hold2Select = document.getElementById('hold2');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sessionMinutesSelect = document.getElementById('sessionMinutes');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sessionTimerDisplay = document.getElementById('sessionTimerDisplay');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const togglePlayPauseBtn = document.getElementById('togglePlayPauseBtn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const resetBtn = document.getElementById('resetBtn');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Animation Canvas elements</p>
<p class="p1"><span class="Apple-converted-space">        </span>const canvas = document.getElementById('breathingAnimationCanvas');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const ctx = canvas.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const ballRadius = 15;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let animationFrameId; // For requestAnimationFrame</p>
<p class="p1"><span class="Apple-converted-space">        </span>let phaseStartTime = 0; // audioContext.currentTime when the current phase began</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Audio Context for sound generation</p>
<p class="p1"><span class="Apple-converted-space">        </span>let audioContext;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let activeOscillator = null; // To keep track of the currently playing continuous sound's oscillator</p>
<p class="p1"><span class="Apple-converted-space">        </span>let activeGainNode = null; // To keep track of the currently playing continuous sound's gain node</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Timer variables</p>
<p class="p1"><span class="Apple-converted-space">        </span>let inhaleDuration = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let hold1Duration = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let exhaleDuration = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let hold2Duration = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let sessionMinutes = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let isTimerRunning = false;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let sessionRemainingTime = 0; // in seconds</p>
<p class="p1"><span class="Apple-converted-space">        </span>let sessionIntervalId;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let currentCyclePhase = 0; // 0: Inhale, 1: Hold1, 2: Exhale, 3: Hold2</p>
<p class="p1"><span class="Apple-converted-space">        </span>let cycleTimeoutId; // Stores the setTimeout ID for the current breathing phase</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Populates a select element with options from 0 to max.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {HTMLSelectElement} selectElement - The select element to populate.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {number} max - The maximum value for the options.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {number} [defaultValue=0] - The default selected value.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function populateDropdown(selectElement, max, defaultValue = 0) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>for (let i = 0; i &lt;= max; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const option = document.createElement('option');</p>
<p class="p1"><span class="Apple-converted-space">                </span>option.value = i;</p>
<p class="p1"><span class="Apple-converted-space">                </span>option.textContent = i;</p>
<p class="p1"><span class="Apple-converted-space">                </span>selectElement.appendChild(option);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectElement.value = defaultValue; // Set default</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Initializes the audio context.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function initAudioContext() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!audioContext) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>audioContext = new (window.AudioContext || window.webkitAudioContext)();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Starts playing a continuous sound. The sound will continue until stopPhaseSound() is called.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Adds a gentle fade-in (attack).</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {number} frequency - The frequency of the sound in Hz.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {string} type - The waveform type ('sine', 'triangle', 'square', 'sawtooth').</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function startPhaseSound(frequency, type = 'triangle') { // Changed default type to 'triangle'</p>
<p class="p1"><span class="Apple-converted-space">            </span>initAudioContext();</p>
<p class="p1"><span class="Apple-converted-space">            </span>stopPhaseSound(); // Ensure any previous continuous sound is stopped</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (audioContext &amp;&amp; audioContext.state === 'suspended') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>audioContext.resume();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>activeOscillator = audioContext.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">            </span>activeGainNode = audioContext.createGain();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>activeOscillator.type = type;</p>
<p class="p1"><span class="Apple-converted-space">            </span>activeOscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Gentle attack (fade-in)</p>
<p class="p1"><span class="Apple-converted-space">            </span>activeGainNode.gain.setValueAtTime(0, audioContext.currentTime); // Start from 0 volume</p>
<p class="p1"><span class="Apple-converted-space">            </span>activeGainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.1); // Ramp up to 0.2 volume over 0.1 seconds</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>activeOscillator.connect(activeGainNode);</p>
<p class="p1"><span class="Apple-converted-space">            </span>activeGainNode.connect(audioContext.destination);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>activeOscillator.start(audioContext.currentTime);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Stops the currently playing continuous phase sound with a gentle fade-out (release).</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function stopPhaseSound() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (activeOscillator &amp;&amp; activeGainNode) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Smooth fade-out (release)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>activeGainNode.gain.cancelAndHoldAtTime(audioContext.currentTime); // Cancel any pending ramps</p>
<p class="p1"><span class="Apple-converted-space">                    </span>activeGainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 0.3); // Fade out to near zero over 0.3 seconds</p>
<p class="p1"><span class="Apple-converted-space">                    </span>activeOscillator.stop(audioContext.currentTime + 0.3); // Stop oscillator after fade-out</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.warn("Error stopping oscillator or disconnecting gainNode (already stopped/disconnected?):", e);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>activeOscillator = null;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>activeGainNode = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Plays a short, distinct tone (e.g., for completion) with a smoother fade.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {number} frequency - The frequency of the sound in Hz.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {number} duration - The duration of the sound in seconds.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function playCompletionTone(frequency, duration) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>initAudioContext();</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (audioContext &amp;&amp; audioContext.state === 'suspended') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>audioContext.resume();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>const tempOscillator = audioContext.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const tempGainNode = audioContext.createGain();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>tempOscillator.type = 'sine'; // Sine wave for a clear, soft completion tone</p>
<p class="p1"><span class="Apple-converted-space">            </span>tempOscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);</p>
<p class="p1"><span class="Apple-converted-space">            </span>tempGainNode.gain.setValueAtTime(0.4, audioContext.currentTime); // Slightly lower volume for completion tone</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>tempOscillator.connect(tempGainNode);</p>
<p class="p1"><span class="Apple-converted-space">            </span>tempGainNode.connect(audioContext.destination);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>tempOscillator.start(audioContext.currentTime);</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Gentle fade out for the completion tone</p>
<p class="p1"><span class="Apple-converted-space">            </span>tempGainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + duration + 0.2); // Fade out over duration + 0.2s</p>
<p class="p1"><span class="Apple-converted-space">            </span>tempOscillator.stop(audioContext.currentTime + duration + 0.3); // Stop after fade out</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Plays the sound for the Inhale phase.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function playInhaleSound() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>startPhaseSound(523.25, 'triangle'); // C5 note, triangle wave</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Plays the sound for the first Hold phase.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function playHold1Sound() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>startPhaseSound(659.25, 'triangle'); // E5 note, triangle wave</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Plays the sound for the Exhale phase.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function playExhaleSound() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>startPhaseSound(440, 'triangle'); // A4 note, triangle wave</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Plays the sound for the second Hold phase.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function playHold2Sound() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>startPhaseSound(392, 'triangle'); // G4 note, triangle wave</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Plays a final session complete sound.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function playCompletionSound() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>playCompletionTone(784, 1); // G5 note, slightly longer duration for clarity</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Updates the displayed session timer.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateSessionTimerDisplay() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const minutes = Math.floor(sessionRemainingTime / 60);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const seconds = sessionRemainingTime % 60;</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionTimerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Starts the overall session timer.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function startSessionTimer() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionIntervalId = setInterval(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (sessionRemainingTime &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>sessionRemainingTime--;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateSessionTimerDisplay();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>stopTimers();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>playCompletionSound();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>alertMessage("Session Complete!", "Your breathing exercise session has ended. Good job!");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, 1000);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Manages the sequence of breathing phases.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function startBreathingCycle() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isTimerRunning) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Clear any pending cycle timeouts before starting a new phase</p>
<p class="p1"><span class="Apple-converted-space">            </span>clearTimeout(cycleTimeoutId);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>let currentPhaseDurationValue = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let currentSoundFunction;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>switch (currentCyclePhase) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 0: // Inhale</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentPhaseDurationValue = inhaleDuration;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentSoundFunction = playInhaleSound;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 1: // Hold 1</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentPhaseDurationValue = hold1Duration;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentSoundFunction = playHold1Sound;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 2: // Exhale</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentPhaseDurationValue = exhaleDuration;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentSoundFunction = playExhaleSound;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 3: // Hold 2</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentPhaseDurationValue = hold2Duration;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentSoundFunction = playHold2Sound;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>default:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("Unknown breathing cycle phase.");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>stopPhaseSound(); // Stop any sound if phase is unknown</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Set the start time for the current animation phase. Ensure audioContext is initialized.</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (audioContext) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>phaseStartTime = audioContext.currentTime;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Play sound for the current phase if its duration is greater than 0</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (currentPhaseDurationValue &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentSoundFunction();</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopPhaseSound(); // If duration is 0, stop any previous sound</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Schedule the next phase. Even if current duration is 0, we still need to</p>
<p class="p1"><span class="Apple-converted-space">            </span>// advance the cycle. Use a minimum timeout of 50ms to allow audio/animation processing.</p>
<p class="p1"><span class="Apple-converted-space">            </span>const nextPhaseDelay = currentPhaseDurationValue &gt; 0 ? currentPhaseDurationValue * 1000 : 50;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>cycleTimeoutId = setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentCyclePhase = (currentCyclePhase + 1) % 4; // Move to next phase, loop back after 3</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (sessionRemainingTime &gt; 0) { // Only continue if session timer is still running</p>
<p class="p1"><span class="Apple-converted-space">                    </span>startBreathingCycle(); // Recurse to start the next phase</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>stopPhaseSound(); // Stop sound if session ends in between phases</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, nextPhaseDelay);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Stops all timers, sounds, and animation.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function stopTimers() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>isTimerRunning = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>clearInterval(sessionIntervalId);</p>
<p class="p1"><span class="Apple-converted-space">            </span>clearTimeout(cycleTimeoutId);</p>
<p class="p1"><span class="Apple-converted-space">            </span>stopPhaseSound(); // Stop the continuous phase sound</p>
<p class="p1"><span class="Apple-converted-space">            </span>cancelAnimationFrame(animationFrameId); // Stop animation</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (audioContext &amp;&amp; audioContext.state === 'running') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>audioContext.suspend(); // Pause the audio context</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>togglePlayPauseBtn.textContent = 'Start';</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Resumes all timers, sounds, and animation.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function resumeTimers() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>isTimerRunning = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (audioContext &amp;&amp; audioContext.state === 'suspended') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>audioContext.resume(); // Resume the audio context</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Reset phaseStartTime here to correctly calculate elapsed time after a pause. Ensure audioContext is initialized.</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (audioContext) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>phaseStartTime = audioContext.currentTime;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>startSessionTimer();</p>
<p class="p1"><span class="Apple-converted-space">            </span>startBreathingCycle();</p>
<p class="p1"><span class="Apple-converted-space">            </span>animationFrameId = requestAnimationFrame(drawBallAnimation); // Resume animation</p>
<p class="p1"><span class="Apple-converted-space">            </span>togglePlayPauseBtn.textContent = 'Pause';</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Handles the click event for the Start/Pause/Resume button.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function handleTogglePlayPause() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Ensure audioContext is initialized before starting any operations that rely on it</p>
<p class="p1"><span class="Apple-converted-space">            </span>initAudioContext(); // Initialize audio context here</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isTimerRunning) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopTimers();</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// First time starting or resuming from pause</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (sessionRemainingTime === 0) { // If session timer is at 0, initialize it from selected minutes</p>
<p class="p1"><span class="Apple-converted-space">                    </span>sessionRemainingTime = parseInt(sessionMinutesSelect.value) * 60;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (sessionRemainingTime === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>alertMessage("Error", "Please select a session duration greater than 0.");</p>
<p class="p1"><span class="Apple-converted-space">                        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Reset breathing cycle to start from Inhale</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentCyclePhase = 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>resumeTimers();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Handles the click event for the Reset button.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function handleReset() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>stopTimers();</p>
<p class="p1"><span class="Apple-converted-space">            </span>inhaleSelect.value = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold1Select.value = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>exhaleSelect.value = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold2Select.value = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionMinutesSelect.value = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>inhaleDuration = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold1Duration = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>exhaleDuration = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold2Duration = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionMinutes = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionRemainingTime = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateSessionTimerDisplay();</p>
<p class="p1"><span class="Apple-converted-space">            </span>togglePlayPauseBtn.textContent = 'Start';</p>
<p class="p1"><span class="Apple-converted-space">            </span>currentCyclePhase = 0; // Reset breathing cycle phase</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Reset ball position on canvas</p>
<p class="p1"><span class="Apple-converted-space">            </span>drawBreathingPath(); // Clear and redraw the path</p>
<p class="p1"><span class="Apple-converted-space">            </span>drawBallAtInitialPosition(); // Draw ball at start</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Displays a custom alert message.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {string} title - The title of the alert.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {string} message - The message content.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function alertMessage(title, message) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const modalId = 'customAlertModal';</p>
<p class="p1"><span class="Apple-converted-space">            </span>let modal = document.getElementById(modalId);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!modal) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>modal = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">                </span>modal.id = modalId;</p>
<p class="p1"><span class="Apple-converted-space">                </span>modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300 opacity-0';</p>
<p class="p1"><span class="Apple-converted-space">                </span>modal.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full transform transition-transform duration-300 scale-95"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h3 class="text-xl font-bold mb-4 text-gray-800" id="alertTitle"&gt;&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-gray-700 mb-6" id="alertMessage"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50" id="alertCloseBtn"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>OK</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.body.appendChild(modal);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('alertCloseBtn').onclick = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modal.classList.remove('opacity-100', 'scale-100');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modal.classList.add('opacity-0', 'scale-95');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setTimeout(() =&gt; modal.style.display = 'none', 300); // Hide after transition</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('alertTitle').textContent = title;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('alertMessage').textContent = message;</p>
<p class="p1"><span class="Apple-converted-space">            </span>modal.style.display = 'flex';</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; { // Trigger transition</p>
<p class="p1"><span class="Apple-converted-space">                </span>modal.classList.remove('opacity-0', 'scale-95');</p>
<p class="p1"><span class="Apple-converted-space">                </span>modal.classList.add('opacity-100', 'scale-100');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, 10);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Draws the static breathing path on the canvas with straight lines for hills/valleys.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function drawBreathingPath() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!ctx) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.clearRect(0, 0, canvas.width, canvas.height);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const phaseWidth = canvas.width / 4;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const paddingFromEdge = 10;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const bottomLineY = canvas.height - ballRadius - paddingFromEdge;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const topLineY = ballRadius + paddingFromEdge;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.strokeStyle = '#9CA3AF'; // Gray-400</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.lineWidth = 3;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Start at the beginning of the first phase (bottom left)</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.moveTo(0, bottomLineY);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Inhale: Straight line from bottom-left to top-right of the segment</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.lineTo(phaseWidth, topLineY);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Hold 1: Flat line at the top</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.lineTo(2 * phaseWidth, topLineY);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Exhale: Straight line from top-left to bottom-right of the segment</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.lineTo(3 * phaseWidth, bottomLineY);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Hold 2: Flat line at the bottom</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.lineTo(canvas.width, bottomLineY);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.stroke(); // Draw the path</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Draws the ball at the calculated position.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {number} x - The x-coordinate of the ball's center.</p>
<p class="p1"><span class="Apple-converted-space">         </span>* @param {number} y - The y-coordinate of the ball's center.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function drawBall(x, y) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.arc(x, y, ballRadius, 0, Math.PI * 2);</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.fillStyle = '#6366F1'; // Indigo 500</p>
<p class="p1"><span class="Apple-converted-space">            </span>ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Draws the ball at its initial position (start of the first phase).</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function drawBallAtInitialPosition() {</p>
<p class="p1"><span class="Apple-converted-space">             </span>const paddingFromEdge = 10;</p>
<p class="p1"><span class="Apple-converted-space">             </span>const bottomLineY = canvas.height - ballRadius - paddingFromEdge;</p>
<p class="p1"><span class="Apple-converted-space">             </span>drawBall(ballRadius, bottomLineY);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/**</p>
<p class="p1"><span class="Apple-converted-space">         </span>* Animates the ball along the breathing path using linear interpolation for slopes.</p>
<p class="p1"><span class="Apple-converted-space">         </span>*/</p>
<p class="p1"><span class="Apple-converted-space">        </span>function drawBallAnimation() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>animationFrameId = requestAnimationFrame(drawBallAnimation);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Only update ball position if the timer is running and audio context is active</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!isTimerRunning || !audioContext || audioContext.state !== 'running') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>return; // Ball position remains static if not running</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>drawBreathingPath(); // Redraw path (and clear previous ball) on each frame</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const phaseWidth = canvas.width / 4;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const paddingFromEdge = 10;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const bottomLineY = canvas.height - ballRadius - paddingFromEdge;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const topLineY = ballRadius + paddingFromEdge;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Determine current phase duration</p>
<p class="p1"><span class="Apple-converted-space">            </span>let currentPhaseDurationValue = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>switch (currentCyclePhase) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 0: currentPhaseDurationValue = inhaleDuration; break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 1: currentPhaseDurationValue = hold1Duration; break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 2: currentPhaseDurationValue = exhaleDuration; break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 3: currentPhaseDurationValue = hold2Duration; break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>let progressInPhase = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (currentPhaseDurationValue &gt; 0 &amp;&amp; audioContext) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const elapsedTimeInPhase = audioContext.currentTime - phaseStartTime;</p>
<p class="p1"><span class="Apple-converted-space">                </span>progressInPhase = Math.min(1, elapsedTimeInPhase / currentPhaseDurationValue);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// If phase duration is 0, instantly complete the phase for animation</p>
<p class="p1"><span class="Apple-converted-space">                </span>progressInPhase = 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>let ballX, ballY;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentSegmentStartX = currentCyclePhase * phaseWidth; // X start of the current phase's segment</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (currentCyclePhase === 0) { // Inhale: Ball moves up a straight line hill</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballX = currentSegmentStartX + (progressInPhase * phaseWidth);</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballY = bottomLineY + (topLineY - bottomLineY) * progressInPhase; // Linear interpolation</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (currentCyclePhase === 1) { // Hold 1: Ball moves on a level plateau (top line)</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballX = currentSegmentStartX + (progressInPhase * phaseWidth);</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballY = topLineY;</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (currentCyclePhase === 2) { // Exhale: Ball moves down a straight line hill</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballX = currentSegmentStartX + (progressInPhase * phaseWidth);</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballY = topLineY + (bottomLineY - topLineY) * progressInPhase; // Linear interpolation</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (currentCyclePhase === 3) { // Hold 2: Ball moves on a flat line (bottom line)</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballX = currentSegmentStartX + (progressInPhase * phaseWidth);</p>
<p class="p1"><span class="Apple-converted-space">                </span>ballY = bottomLineY;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Draw the ball at its calculated position</p>
<p class="p1"><span class="Apple-converted-space">            </span>drawBall(ballX, ballY);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Event Listeners</p>
<p class="p1"><span class="Apple-converted-space">        </span>window.onload = function() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Set canvas size dynamically to fill its max-width, while keeping fixed height</p>
<p class="p1"><span class="Apple-converted-space">            </span>const containerWidth = canvas.parentElement.offsetWidth;</p>
<p class="p1"><span class="Apple-converted-space">            </span>canvas.width = Math.min(containerWidth, 440); // Max width from CSS</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Note: Canvas height is fixed at 150px in CSS for consistent animation space</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Populate dropdowns</p>
<p class="p1"><span class="Apple-converted-space">            </span>populateDropdown(inhaleSelect, 60, 4);</p>
<p class="p1"><span class="Apple-converted-space">            </span>populateDropdown(hold1Select, 60, 4);</p>
<p class="p1"><span class="Apple-converted-space">            </span>populateDropdown(exhaleSelect, 60, 6);</p>
<p class="p1"><span class="Apple-converted-space">            </span>populateDropdown(hold2Select, 60, 2);</p>
<p class="p1"><span class="Apple-converted-space">            </span>populateDropdown(sessionMinutesSelect, 60, 5); // Default to 5 minutes</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Initial load of values</p>
<p class="p1"><span class="Apple-converted-space">            </span>inhaleDuration = parseInt(inhaleSelect.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold1Duration = parseInt(hold1Select.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>exhaleDuration = parseInt(exhaleSelect.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold2Duration = parseInt(hold2Select.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionMinutes = parseInt(sessionMinutesSelect.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionRemainingTime = sessionMinutes * 60; // Initialize session time in seconds</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateSessionTimerDisplay(); // Display initial time</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Add event listeners for dropdown changes</p>
<p class="p1"><span class="Apple-converted-space">            </span>inhaleSelect.addEventListener('change', (e) =&gt; inhaleDuration = parseInt(e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold1Select.addEventListener('change', (e) =&gt; hold1Duration = parseInt(e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>exhaleSelect.addEventListener('change', (e) =&gt; exhaleDuration = parseInt(e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>hold2Select.addEventListener('change', (e) =&gt; hold2Duration = parseInt(e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>sessionMinutesSelect.addEventListener('change', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>sessionMinutes = parseInt(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!isTimerRunning) { // Only update if not running to avoid resetting active timer</p>
<p class="p1"><span class="Apple-converted-space">                    </span>sessionRemainingTime = sessionMinutes * 60;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateSessionTimerDisplay();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Button event listeners</p>
<p class="p1"><span class="Apple-converted-space">            </span>togglePlayPauseBtn.addEventListener('click', handleTogglePlayPause);</p>
<p class="p1"><span class="Apple-converted-space">            </span>resetBtn.addEventListener('click', handleReset);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Start the animation loop when the page loads to draw the initial path and ball</p>
<p class="p1"><span class="Apple-converted-space">            </span>drawBreathingPath();</p>
<p class="p1"><span class="Apple-converted-space">            </span>drawBallAtInitialPosition();</p>
<p class="p1"><span class="Apple-converted-space">            </span>animationFrameId = requestAnimationFrame(drawBallAnimation);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
